

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Confound Removal (model comparison) &mdash; julearn  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-rendered-html.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Advanced Examples" href="../advanced/index.html" />
    <link rel="prev" title="Regression Analysis" href="plot_example_regression.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> julearn
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installing julearn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input.html">Input Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pipeline.html">Understanding the pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pipeline.html#advanced-topics">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steps.html">Available Pipeline Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hyperparameters.html">Hyperparameters</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Basic Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="run_simple_binary_classification.html">Simple Binary Classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_inspect_random_forest.html">Inspecting Random Forest models</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_cm_acc_multiclass.html">Multiclass Classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_groupcv_inspect_svm.html">Inspecting SVM models</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_example_regression.html">Regression Analysis</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Confound Removal (model comparison)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">Advanced Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing to julearn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintaining.html">Maintaining julearn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../whats_new.html">What’s new</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">julearn</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Basic Examples</a> &raquo;</li>
        
      <li>Confound Removal (model comparison)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/auto_examples/basic/plot_confound_removal_classification.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-basic-plot-confound-removal-classification-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="confound-removal-model-comparison">
<span id="sphx-glr-auto-examples-basic-plot-confound-removal-classification-py"></span><h1>Confound Removal (model comparison)<a class="headerlink" href="#confound-removal-model-comparison" title="Permalink to this headline">¶</a></h1>
<p>This example uses the ‘iris’ dataset, performs simple binary classification
with and without confound removal using a Random Forest classifier.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Authors: Shammi More &lt;s.more@fz-juelich.de&gt;</span>
<span class="c1">#          Federico Raimondo &lt;f.raimondo@fz-juelich.de&gt;</span>
<span class="c1">#</span>
<span class="c1"># License: AGPL</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">seaborn</span> <span class="kn">import</span> <span class="n">load_dataset</span>

<span class="kn">from</span> <span class="nn">julearn</span> <span class="kn">import</span> <span class="n">run_cross_validation</span>
<span class="kn">from</span> <span class="nn">julearn.utils</span> <span class="kn">import</span> <span class="n">configure_logging</span>
<span class="kn">from</span> <span class="nn">julearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedBootstrap</span>
</pre></div>
</div>
<p>Set the logging level to info to see extra information</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">configure_logging</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>2021-02-26 20:12:33,130 - julearn - INFO - ===== Lib Versions =====
2021-02-26 20:12:33,130 - julearn - INFO - numpy: 1.19.5
2021-02-26 20:12:33,130 - julearn - INFO - scipy: 1.6.1
2021-02-26 20:12:33,130 - julearn - INFO - sklearn: 0.24.1
2021-02-26 20:12:33,130 - julearn - INFO - pandas: 1.2.2
2021-02-26 20:12:33,130 - julearn - INFO - julearn: 0.2.5.dev23+g7f3ac65
2021-02-26 20:12:33,130 - julearn - INFO - ========================
</pre></div>
</div>
<p>load the iris data from seaborn</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_iris</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s1">&#39;iris&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The dataset has three kind of species. We will keep two to perform a binary
classification.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_iris</span> <span class="o">=</span> <span class="n">df_iris</span><span class="p">[</span><span class="n">df_iris</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;versicolor&#39;</span><span class="p">,</span> <span class="s1">&#39;virginica&#39;</span><span class="p">])]</span>
</pre></div>
</div>
<p>As features, we will use the sepal length, width and petal length and use
petal width as confound.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sepal_length&#39;</span><span class="p">,</span> <span class="s1">&#39;sepal_width&#39;</span><span class="p">,</span> <span class="s1">&#39;petal_length&#39;</span><span class="p">]</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a> <span class="o">=</span> <span class="s1">&#39;species&#39;</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">confound</span></a> <span class="o">=</span> <span class="s1">&#39;petal_width&#39;</span>
</pre></div>
</div>
<p>Doing hypothesis testing in ML is not that simple. If we were to used
classical frequentist statistics, we have the problem that using cross
validation, the samples are not independent and the population (train + test)
is always the same.</p>
<p>If we want to compare two models, an alternative is to contrast, for each
fold, the performance gap between the models. If we combine that approach
with bootstrapping, we can then compare the confidence intervals of the
difference. If the 95% CI is above 0 (or below), we can claim that the models
are different with p &lt; 0.05.</p>
<p>Lets use a bootstrap CV. For time purposes we do 20 iterations, change the
number of bootstrap iterations to at least 2000 for a valid test.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_bootstrap</span></a> <span class="o">=</span> <span class="mi">20</span>
<a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_elements</span></a> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_iris</span><span class="p">)</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedBootstrap</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_bootstrap</span></a><span class="p">,</span> <span class="n">test_size</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
<p>First, we will train a model without performing confound removal on features
Note: confounds=None by default</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scores_ncr</span> <span class="o">=</span> <span class="n">run_cross_validation</span><span class="p">(</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_iris</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;rf&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">preprocess_X</span><span class="o">=</span><span class="s1">&#39;zscore&#39;</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;roc_auc&#39;</span><span class="p">],</span> <span class="n">return_estimator</span><span class="o">=</span><span class="s1">&#39;cv&#39;</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>2021-02-26 20:12:33,135 - julearn - INFO - Setting random seed to 200
2021-02-26 20:12:33,135 - julearn - INFO - ==== Input Data ====
2021-02-26 20:12:33,135 - julearn - INFO - Using dataframe as input
2021-02-26 20:12:33,135 - julearn - INFO - Features: [&#39;sepal_length&#39;, &#39;sepal_width&#39;, &#39;petal_length&#39;]
2021-02-26 20:12:33,135 - julearn - INFO - Target: species
2021-02-26 20:12:33,136 - julearn - INFO - Expanded X: [&#39;sepal_length&#39;, &#39;sepal_width&#39;, &#39;petal_length&#39;]
2021-02-26 20:12:33,136 - julearn - INFO - Expanded Confounds: []
2021-02-26 20:12:33,137 - julearn - INFO - ====================
2021-02-26 20:12:33,137 - julearn - INFO -
2021-02-26 20:12:33,137 - julearn - INFO - ====== Model ======
2021-02-26 20:12:33,137 - julearn - INFO - Obtaining model by name: rf
2021-02-26 20:12:33,137 - julearn - INFO - ===================
2021-02-26 20:12:33,137 - julearn - INFO -
2021-02-26 20:12:33,137 - julearn - INFO - Using scikit-learn CV scheme StratifiedBootstrap(n_splits=20, random_state=42, test_size=0.3,
          train_size=None)
</pre></div>
</div>
<p>Next, we train a model after performing confound removal on the features
Note: we initialize the CV again to use the same folds as before</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedBootstrap</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_bootstrap</span></a><span class="p">,</span> <span class="n">test_size</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">scores_cr</span> <span class="o">=</span> <span class="n">run_cross_validation</span><span class="p">(</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a><span class="p">,</span> <span class="n">confounds</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">confound</span></a><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_iris</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;rf&#39;</span><span class="p">,</span>
    <span class="n">preprocess_X</span><span class="o">=</span><span class="s1">&#39;remove_confound&#39;</span><span class="p">,</span> <span class="n">preprocess_confounds</span><span class="o">=</span><span class="s1">&#39;zscore&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;roc_auc&#39;</span><span class="p">],</span> <span class="n">return_estimator</span><span class="o">=</span><span class="s1">&#39;cv&#39;</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>2021-02-26 20:12:36,727 - julearn - INFO - Setting random seed to 200
2021-02-26 20:12:36,727 - julearn - INFO - ==== Input Data ====
2021-02-26 20:12:36,727 - julearn - INFO - Using dataframe as input
2021-02-26 20:12:36,728 - julearn - INFO - Features: [&#39;sepal_length&#39;, &#39;sepal_width&#39;, &#39;petal_length&#39;]
2021-02-26 20:12:36,728 - julearn - INFO - Target: species
2021-02-26 20:12:36,728 - julearn - INFO - Confounds: petal_width
2021-02-26 20:12:36,728 - julearn - INFO - Expanded X: [&#39;sepal_length&#39;, &#39;sepal_width&#39;, &#39;petal_length&#39;]
2021-02-26 20:12:36,728 - julearn - INFO - Expanded Confounds: [&#39;petal_width&#39;]
2021-02-26 20:12:36,729 - julearn - INFO - ====================
2021-02-26 20:12:36,729 - julearn - INFO -
2021-02-26 20:12:36,729 - julearn - INFO - ====== Model ======
2021-02-26 20:12:36,729 - julearn - INFO - Obtaining model by name: rf
2021-02-26 20:12:36,729 - julearn - INFO - ===================
2021-02-26 20:12:36,729 - julearn - INFO -
2021-02-26 20:12:36,730 - julearn - INFO - Using scikit-learn CV scheme StratifiedBootstrap(n_splits=20, random_state=42, test_size=0.3,
          train_size=None)
</pre></div>
</div>
<p>Now we can compare the accuracies. We can combine the two outputs as
pandas dataframes</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scores_ncr</span><span class="p">[</span><span class="s1">&#39;confounds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Not Removed&#39;</span>
<span class="n">scores_cr</span><span class="p">[</span><span class="s1">&#39;confounds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Removed&#39;</span>
</pre></div>
</div>
<p>Now we convert the metrics to a column for easier seaborn plotting (convert
to long format)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">index</span></a> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fold&#39;</span><span class="p">,</span> <span class="s1">&#39;confounds&#39;</span><span class="p">]</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">scorings</span></a> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;test_roc_auc&#39;</span><span class="p">]</span>

<span class="n">df_ncr_metrics</span> <span class="o">=</span> <span class="n">scores_ncr</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">index</span></a><span class="p">)[</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">scorings</span></a><span class="p">]</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
<span class="n">df_ncr_metrics</span><span class="o">.</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">index</span></a><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fold&#39;</span><span class="p">,</span> <span class="s1">&#39;confounds&#39;</span><span class="p">,</span> <span class="s1">&#39;metric&#39;</span><span class="p">]</span>
<span class="n">df_ncr_metrics</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span>

<span class="n">df_cr_metrics</span> <span class="o">=</span> <span class="n">scores_cr</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">index</span></a><span class="p">)[</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">scorings</span></a><span class="p">]</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
<span class="n">df_cr_metrics</span><span class="o">.</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">index</span></a><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fold&#39;</span><span class="p">,</span> <span class="s1">&#39;confounds&#39;</span><span class="p">,</span> <span class="s1">&#39;metric&#39;</span><span class="p">]</span>
<span class="n">df_cr_metrics</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span>

<span class="n">df_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">df_ncr_metrics</span><span class="p">,</span> <span class="n">df_cr_metrics</span><span class="p">))</span>

<span class="n">df_metrics</span> <span class="o">=</span> <span class="n">df_metrics</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_metrics</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>   fold    confounds         metric     value
0     0  Not Removed  test_accuracy  0.933333
1     0  Not Removed   test_roc_auc  0.968889
2     1  Not Removed  test_accuracy  0.933333
3     1  Not Removed   test_roc_auc  0.948889
4     2  Not Removed  test_accuracy  1.000000
</pre></div>
</div>
<p>And finally plot the results</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;confounds&#39;</span><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;metric&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_metrics</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;swarm&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="metric = test_accuracy, metric = test_roc_auc" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_confound_removal_classification_001.png" />
<p>While this plot allows us to see the mean performance values and compare
them, these samples are paired. In order to see if there is a systematic
difference, we need to check the distribution of differeces between the
the models.</p>
<p>First we remove the column “confounds” from the index and make the difference
between the metrics</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_cr_metrics</span> <span class="o">=</span> <span class="n">df_cr_metrics</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;fold&#39;</span><span class="p">,</span> <span class="s1">&#39;metric&#39;</span><span class="p">])</span>
<span class="n">df_ncr_metrics</span> <span class="o">=</span> <span class="n">df_ncr_metrics</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;fold&#39;</span><span class="p">,</span> <span class="s1">&#39;metric&#39;</span><span class="p">])</span>

<span class="n">df_diff_metrics</span> <span class="o">=</span> <span class="n">df_ncr_metrics</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_cr_metrics</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
<span class="n">df_diff_metrics</span> <span class="o">=</span> <span class="n">df_diff_metrics</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
<p>Now we can finally plot the difference, setting the whiskers of the box plot
at 2.5 and 97.5 to see the 95% CI.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;metric&#39;</span><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_diff_metrics</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
            <span class="n">whis</span><span class="o">=</span><span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="plot confound removal classification" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_confound_removal_classification_002.png" />
<p>We can see that while it seems that the accuracy and ROC AUC scores are
higher when confounds are not removed. We can not really claim (using this
test), that the models are different in terms of these metrics.</p>
<p>Maybe the percentiles will be more accuracy with the proper amount of
bootstrap iterations?</p>
<p>But the main point of confound removal is for interpretability. Lets see
if there is a change in the feature importances.</p>
<p>First, we need to collect the feature importances for each model, for each
fold.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ncr_fi</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">i_fold</span></a><span class="p">,</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scores_ncr</span><span class="p">[</span><span class="s1">&#39;estimator&#39;</span><span class="p">]):</span>
    <span class="n">this_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;feature&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">],</span>
        <span class="s1">&#39;importance&#39;</span><span class="p">:</span> <span class="n">estimator</span><span class="p">[</span><span class="s1">&#39;rf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span>
        <span class="s1">&#39;confounds&#39;</span><span class="p">:</span> <span class="s1">&#39;Not Removed&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fold&#39;</span><span class="p">:</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">i_fold</span></a>
    <span class="p">})</span>
    <span class="n">ncr_fi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_importances</span><span class="p">)</span>
<span class="n">ncr_fi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">ncr_fi</span><span class="p">)</span>

<span class="n">cr_fi</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">i_fold</span></a><span class="p">,</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scores_cr</span><span class="p">[</span><span class="s1">&#39;estimator&#39;</span><span class="p">]):</span>
    <span class="n">this_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;feature&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">],</span>
        <span class="s1">&#39;importance&#39;</span><span class="p">:</span> <span class="n">estimator</span><span class="p">[</span><span class="s1">&#39;rf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span>
        <span class="s1">&#39;confounds&#39;</span><span class="p">:</span> <span class="s1">&#39;Removed&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fold&#39;</span><span class="p">:</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">i_fold</span></a>
    <span class="p">})</span>
    <span class="n">cr_fi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_importances</span><span class="p">)</span>
<span class="n">cr_fi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">cr_fi</span><span class="p">)</span>

<span class="n">feature_importance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cr_fi</span><span class="p">,</span> <span class="n">ncr_fi</span><span class="p">])</span>
</pre></div>
</div>
<p>We can now plot the importances</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a><span class="o">=</span><span class="s1">&#39;importance&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;confounds&#39;</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">feature_importance</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;swarm&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="plot confound removal classification" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_confound_removal_classification_003.png" />
<p>And check the differences in importances. We can now see that there is
a difference in importances.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">diff_fi</span> <span class="o">=</span> <span class="p">(</span><span class="n">cr_fi</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span> <span class="s1">&#39;fold&#39;</span><span class="p">])[</span><span class="s1">&#39;importance&#39;</span><span class="p">]</span> <span class="o">-</span>
           <span class="n">ncr_fi</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span> <span class="s1">&#39;fold&#39;</span><span class="p">])[</span><span class="s1">&#39;importance&#39;</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;importance&#39;</span><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a><span class="o">=</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">diff_fi</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
            <span class="n">whis</span><span class="o">=</span><span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="plot confound removal classification" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_confound_removal_classification_004.png" />
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  9.687 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-basic-plot-confound-removal-classification-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/a04a8d098f83972da74112b5a7f757ed/plot_confound_removal_classification.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_confound_removal_classification.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/718796dccf36e95288b1c1f1c1661d20/plot_confound_removal_classification.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_confound_removal_classification.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../advanced/index.html" class="btn btn-neutral float-right" title="Advanced Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="plot_example_regression.html" class="btn btn-neutral float-left" title="Regression Analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Authors of julearn.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: main
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Tags</dt>
      <dd><a href="../../../v0.2.2/index.html">v0.2.2</a></dd>
      <dd><a href="../../../v0.2.3/index.html">v0.2.3</a></dd>
      <dd><a href="../../../v0.2.4/index.html">v0.2.4</a></dd>
    </dl>
    <dl>
      <dt>Branches</dt>
      <dd><a href="plot_confound_removal_classification.html">main</a></dd>
    </dl>
  </div>
</div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>